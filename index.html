<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOL评论关键词共现矩阵图</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 50%, #fae8ff 100%);
            overflow: hidden;
        }
        
        #container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-sizing: border-box;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.1);
            border: 1px solid rgba(249, 168, 212, 0.3);
            flex-shrink: 0;
        }
        
        .title {
            color: #9d174d;
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 5px 0;
            text-shadow: 0 2px 4px rgba(157, 23, 77, 0.1);
        }
        
        .subtitle {
            color: #db2777;
            font-size: 14px;
            opacity: 0.8;
            margin: 0;
        }
        
        #chart {
            flex: 1;
            width: 100%;
            min-height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 25px rgba(219, 39, 119, 0.15);
            border: 1px solid rgba(249, 168, 212, 0.4);
            background: rgba(255, 255, 255, 0.97);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 12px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #9d174d;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            #container {
                padding: 10px;
            }
            
            .header {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .title {
                font-size: 20px;
            }
            
            .subtitle {
                font-size: 13px;
            }
            
            .legend {
                gap: 10px;
                margin-top: 10px;
            }
            
            .legend-item {
                font-size: 12px;
            }
            
            .legend-color {
                width: 12px;
                height: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="header">
            <h1 class="title">KOL婚育话题评论关键词共现矩阵</h1>
            <p class="subtitle">基于共现矩阵数据生成 | 粉色系高级视觉设计</p>
        </div>
        <div id="chart"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #FFB6C1;"></div>
                <span>高频词 (100+)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFC0CB;"></div>
                <span>中高频词 (50-100)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FF69B4;"></div>
                <span>中频词 (30-50)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FF1493;"></div>
                <span>低频词 (&lt;30)</span>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // 初始化图表
        var chartDom = document.getElementById('chart');
        var myChart = echarts.init(chartDom);
        
        // 从Excel数据创建JSON结构
        function createGraphData() {
            // 关键词列表
            const keywords = [
                "结婚", "不婚", "幸福", "家庭", "生育", "压力", "痛苦", "小孩", "不育", "养老",
                "自由", "单身", "自我", "独立", "决定", "经济", "儿女", "清醒", "孤独", "愿意",
                "焦虑", "丁克", "优秀", "开心", "害怕", "未婚", "生活方式", "婚姻制度", "牺牲", "子女",
                "担忧", "养老院", "孤单", "无奈", "有钱", "自主", "经济独立", "搞钱"
            ];
            
            // 共现矩阵
            const cooccurrenceMatrix = [
                [125, 12, 16, 5, 2, 5, 7, 10, 5, 3, 5, 5, 5, 1, 6, 0, 3, 3, 3, 2, 1, 2, 2, 4, 1, 3, 1, 0, 3, 3, 2, 1, 0, 1, 2, 1, 0, 1],
                [12, 70, 7, 4, 4, 3, 3, 4, 36, 2, 3, 3, 3, 1, 1, 1, 0, 1, 0, 4, 1, 9, 1, 1, 1, 2, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
                [16, 7, 49, 7, 2, 3, 2, 0, 4, 2, 2, 1, 3, 3, 2, 1, 3, 1, 2, 2, 1, 2, 1, 4, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
                [5, 4, 7, 33, 6, 3, 4, 3, 2, 3, 3, 0, 1, 4, 2, 3, 1, 1, 2, 0, 1, 0, 1, 2, 0, 1, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 4, 2, 6, 29, 3, 3, 5, 3, 2, 2, 1, 0, 3, 0, 2, 1, 0, 2, 1, 1, 2, 1, 0, 0, 1, 2, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [5, 3, 3, 3, 3, 16, 1, 1, 2, 1, 1, 2, 0, 1, 1, 1, 1, 0, 1, 0, 2, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
                [7, 3, 2, 4, 3, 1, 39, 3, 2, 0, 2, 1, 1, 0, 1, 0, 1, 3, 2, 3, 0, 2, 1, 1, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
                [10, 4, 0, 3, 5, 1, 3, 20, 4, 2, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0],
                [5, 36, 4, 2, 3, 2, 2, 4, 37, 2, 3, 1, 2, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [3, 2, 2, 3, 2, 1, 0, 2, 2, 20, 1, 0, 0, 3, 0, 2, 1, 0, 0, 0, 2, 0, 1, 0, 0, 1, 0, 0, 1, 2, 0, 3, 0, 0, 1, 0, 0, 0],
                [5, 3, 2, 3, 2, 1, 2, 1, 3, 1, 23, 1, 2, 2, 1, 2, 0, 0, 0, 2, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
                [5, 3, 1, 0, 1, 2, 1, 0, 1, 0, 1, 29, 2, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 3, 1, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [5, 3, 3, 1, 0, 0, 1, 1, 2, 0, 2, 2, 41, 0, 0, 0, 1, 1, 0, 4, 0, 2, 0, 2, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 1, 3, 4, 3, 1, 0, 1, 1, 3, 2, 0, 0, 17, 0, 4, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                [6, 1, 2, 2, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 17, 0, 2, 1, 0, 1, 0, 1, 0, 2, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0],
                [0, 1, 1, 3, 2, 1, 0, 1, 1, 2, 2, 0, 0, 4, 0, 10, 1, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                [3, 0, 3, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 2, 1, 9, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [3, 1, 1, 1, 0, 0, 3, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 27, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [3, 0, 2, 2, 2, 1, 2, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 8, 0, 0, 0, 1, 0, 2, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
                [2, 4, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 4, 0, 1, 0, 0, 1, 0, 14, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 1, 1, 1, 1, 2, 0, 0, 1, 2, 0, 1, 0, 1, 0, 2, 1, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 9, 2, 0, 2, 0, 2, 1, 1, 0, 0, 0, 2, 0, 1, 0, 0, 1, 0, 1, 0, 17, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [2, 1, 1, 1, 1, 1, 1, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 36, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
                [4, 1, 4, 2, 0, 1, 1, 1, 0, 0, 0, 3, 2, 0, 2, 0, 1, 0, 0, 0, 0, 0, 0, 24, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 9, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0],
                [3, 2, 0, 1, 1, 1, 0, 0, 0, 1, 0, 2, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 2, 0, 0, 15, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 1, 0, 2, 2, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [3, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [3, 0, 0, 0, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 14, 0, 3, 0, 0, 0, 0, 0, 0],
                [2, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 1, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 8, 0, 0, 0, 0, 0, 0],
                [0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0],
                [2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0],
                [1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5]
            ];
            
            // 粉色系颜色数组（从浅到深）
            const pinkColors = [
                '#FFB6C1', '#FFC0CB', '#FF69B4', '#FF1493', '#DB7093',
                '#FF82AB', '#FF6EB4', '#FF34B3', '#FF00FF', '#D8BFD8',
                '#DDA0DD', '#EE82EE', '#DA70D6', '#BA55D3', '#9370DB',
                '#8A2BE2', '#9400D3', '#9932CC', '#8B008B', '#800080'
            ];
            
            // 计算每个节点的总出现次数（对角线值）和总连接强度
            const nodeValues = [];
            const nodeConnections = [];
            
            for (let i = 0; i < keywords.length; i++) {
                nodeValues.push(cooccurrenceMatrix[i][i]);
                
                // 计算该节点与其他节点的连接强度总和
                let connectionStrength = 0;
                for (let j = 0; j < keywords.length; j++) {
                    if (i !== j && cooccurrenceMatrix[i][j] > 0) {
                        connectionStrength += cooccurrenceMatrix[i][j];
                    }
                }
                nodeConnections.push(connectionStrength);
            }
            
            // 创建节点数据
            const nodes = [];
            const maxNodeValue = Math.max(...nodeValues);
            const maxConnection = Math.max(...nodeConnections);
            
            // 使用力导向布局的初始位置（圆形排列）
            const centerX = 400;
            const centerY = 300;
            const radius = 250;
            
            for (let i = 0; i < keywords.length; i++) {
                const nodeValue = nodeValues[i];
                const connectionStrength = nodeConnections[i];
                
                // 根据节点值计算大小
                const nodeSize = Math.sqrt(nodeValue) * 2 + 20;
                
                // 根据节点值分配颜色（值越大，颜色越深）
                const colorIndex = Math.floor((nodeValue / maxNodeValue) * (pinkColors.length - 1));
                const color = pinkColors[colorIndex] || pinkColors[pinkColors.length - 1];
                
                // 计算初始位置（圆形排列）
                const angle = (i / keywords.length) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                nodes.push({
                    id: i.toString(),
                    name: keywords[i],
                    value: nodeValue,
                    connection: connectionStrength,
                    symbolSize: nodeSize,
                    x: x,
                    y: y,
                    itemStyle: {
                        color: color,
                        borderColor: '#C2185B',
                        borderWidth: 2,
                        shadowBlur: 10,
                        shadowColor: 'rgba(219, 39, 119, 0.3)'
                    }
                });
            }
            
            // 创建边数据
            const edges = [];
            const maxCooccurrence = Math.max(...cooccurrenceMatrix.flat());
            
            for (let i = 0; i < keywords.length; i++) {
                for (let j = i + 1; j < keywords.length; j++) {
                    const cooccurrence = cooccurrenceMatrix[i][j];
                    if (cooccurrence > 0) {
                        // 根据共现次数计算线宽
                        const lineWidth = Math.sqrt(cooccurrence) * 0.8;
                        
                        // 根据共现次数计算透明度
                        const opacity = 0.3 + (cooccurrence / maxCooccurrence) * 0.7;
                        
                        edges.push({
                            source: i.toString(),
                            target: j.toString(),
                            value: cooccurrence,
                            lineStyle: {
                                width: lineWidth,
                                curveness: 0.3,
                                color: `rgba(219, 39, 119, ${opacity})`,
                                opacity: opacity
                            }
                        });
                    }
                }
            }
            
            return {
                nodes: nodes,
                edges: edges
            };
        }
        
        // 初始化图表函数
        function initChart() {
            // 显示加载动画
            myChart.showLoading();
            
            // 使用setTimeout模拟加载数据
            setTimeout(function() {
                // 创建图数据
                var json = createGraphData();
                
                // 隐藏加载动画
                myChart.hideLoading();
                
                // 设置图表选项
                myChart.setOption({
                    title: {
                        text: 'KOL帖子评论关键词共现关系图',
                        left: 'center',
                        textStyle: {
                            color: '#9d174d',
                            fontSize: 20,
                            fontWeight: 'bold',
                            fontFamily: 'PingFang SC, Microsoft YaHei'
                        },
                        subtext: '节点大小表示词频 | 连线粗细表示共现强度',
                        subtextStyle: {
                            color: '#db2777',
                            fontSize: 13,
                            fontFamily: 'PingFang SC, Microsoft YaHei'
                        }
                    },
                    animationDurationUpdate: 1500,
                    animationEasingUpdate: 'quinticInOut',
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            if (params.dataType === 'node') {
                                return `<div style="font-weight:bold;color:#9d174d;">${params.data.name}</div>
                                        <div>词频: ${params.data.value}</div>
                                        <div>连接强度: ${params.data.connection}</div>`;
                            } else if (params.dataType === 'edge') {
                                // 查找源节点和目标节点
                                const sourceNode = json.nodes.find(n => n.id === params.data.source);
                                const targetNode = json.nodes.find(n => n.id === params.data.target);
                                return `<div style="font-weight:bold;color:#9d174d;">${sourceNode.name} ↔ ${targetNode.name}</div>
                                        <div>共现次数: ${params.data.value}</div>`;
                            }
                            return '';
                        },
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        borderColor: '#EC4899',
                        borderWidth: 1,
                        textStyle: {
                            color: '#9d174d',
                            fontFamily: 'PingFang SC, Microsoft YaHei'
                        },
                        extraCssText: 'box-shadow: 0 4px 12px rgba(236, 72, 153, 0.2); border-radius: 8px;'
                    },
                    series: [
                        {
                            type: 'graph',
                            layout: 'force',
                            force: {
                                repulsion: 300,
                                edgeLength: [80, 150],
                                gravity: 0.1,
                                friction: 0.6
                            },
                            draggable: true,
                            roam: true,
                            roamTrigger: 'global',
                            focusNodeAdjacency: true,
                            edgeSymbol: ['none', 'arrow'],
                            edgeSymbolSize: [4, 8],
                            edgeLabel: {
                                show: true,
                                formatter: function(params) {
                                    return params.data.value;
                                },
                                fontSize: 10,
                                color: '#9d174d',
                                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                borderColor: '#EC4899',
                                borderWidth: 1,
                                padding: [2, 5],
                                borderRadius: 4,
                                fontFamily: 'PingFang SC, Microsoft YaHei'
                            },
                            label: {
                                show: true,
                                position: 'right',
                                fontSize: 13,
                                fontWeight: 'bold',
                                color: '#9d174d',
                                fontFamily: 'PingFang SC, Microsoft YaHei',
                                formatter: function(params) {
                                    return params.data.name;
                                }
                            },
                            emphasis: {
                                scale: true,
                                focus: 'adjacency',
                                label: {
                                    show: true,
                                    fontSize: 14,
                                    fontWeight: 'bold',
                                    color: '#C2185B',
                                    fontFamily: 'PingFang SC, Microsoft YaHei'
                                },
                                edgeLabel: {
                                    show: true,
                                    fontSize: 11,
                                    fontWeight: 'bold',
                                    color: '#C2185B',
                                    fontFamily: 'PingFang SC, Microsoft YaHei'
                                },
                                lineStyle: {
                                    width: 3,
                                    color: 'rgba(219, 39, 119, 0.9)'
                                },
                                itemStyle: {
                                    shadowBlur: 20,
                                    shadowColor: 'rgba(236, 72, 153, 0.8)'
                                }
                            },
                            lineStyle: {
                                width: 0.5,
                                curveness: 0.3,
                                opacity: 0.7
                            },
                            data: json.nodes.map(function (node) {
                                return {
                                    x: node.x,
                                    y: node.y,
                                    id: node.id,
                                    name: node.name,
                                    value: node.value,
                                    connection: node.connection,
                                    symbolSize: node.symbolSize,
                                    itemStyle: node.itemStyle,
                                    label: {
                                        show: true,
                                        fontSize: 13,
                                        fontWeight: 'bold',
                                        color: '#9d174d'
                                    }
                                };
                            }),
                            edges: json.edges.map(function (edge) {
                                return {
                                    source: edge.source,
                                    target: edge.target,
                                    value: edge.value,
                                    lineStyle: edge.lineStyle
                                };
                            })
                        }
                    ],
                    backgroundColor: 'rgba(255, 255, 255, 0.9)'
                });
                
            }, 800); // 模拟0.8秒加载时间
        }
        
        // 初始化图表
        initChart();
        
        // 响应式调整函数
        function resizeChart() {
            myChart.resize();
        }
        
        // 窗口大小改变时重绘图表
        window.addEventListener('resize', resizeChart);
        
        // 添加一个ResizeObserver来监听容器大小变化（更精确的响应式）
        if (typeof ResizeObserver !== 'undefined') {
            const resizeObserver = new ResizeObserver(resizeChart);
            resizeObserver.observe(chartDom);
        }
        
        // 添加iframe通信支持（可选）
        window.addEventListener('message', function(event) {
            // 可以在这里添加与父页面的通信逻辑
            if (event.data && event.data.type === 'resize') {
                resizeChart();
            }
        });
    </script>
</body>
</html>